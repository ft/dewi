#!@@POSIX_SH@@
# Copyright (c) 2010
# Frank Terbeck <ft@bewatermyfriend.org>, All rights reserved.
# Terms for redistribution and use can be found in `LICENCE'.

d=".dewi/lib"
. "$d"/shell.sh

if [ "$#" != 1 ]; then
    printf 'Usage: bootstrap.sh <dir>\n'
    printf '  ...where `<dir>'\'' is the directory you want to bootstrap.\n'
    printf '  Only *one* directory per run is permitted.\n'
    exit 1
fi
dir="$1"

if [ ! -d "$dir" ]; then
    printf 'Not a directory: "%s". Abort.\n' "$dir"
    exit 1
fi

if __is_dewified "$dir"; then
    printf 'Directory "%s" is already dewified. Doing nothing.\n' "$dir"
    exit 0
fi

if [ -e "$dir"/Makefile ]; then
    printf 'Makefile exists in `%s'\''. Giving up.\n' "$dir"
    exit 0
fi

(
    cd "$dir" || exit 1
    printf 'Bootstrapping `%s'\'':\n' "$dir"
    printf '  Installing `Dewifile'\''...\n'
    cp -- ../.dewi/lib/Dewifile.stub Dewifile || exit 1
    printf '  Installing `Makefile'\''...\n'
    cp -- ../.dewi/lib/child.mk Makefile || exit 1
    exit 0
)
if [ "$?" != "0" ]; then
    die 'Bootstrapping '"$dir"' failed!'
fi
exit 0
